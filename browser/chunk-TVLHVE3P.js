import{Ia as f,Na as l,Oa as I,Ra as b,c as v,e as g,f as i,i as h,j as s,l as m,n as u,q as d,t as S,w as n}from"./chunk-MMKYUMEW.js";var y=class c{helperService=n(I);http=n(f);router=n(b);clearSessions(){localStorage.clear(),this.router.navigate(["/auth/login"])}loginRequestAdmin(t){return s(()=>this.http.post(`${l.API_URL_EXT}/ChromeExtension/ChromeExtension/filtro`,t))}loginRequestProvider(t){return s(()=>this.http.post(`${l.API_URL}/Login.aspx`,t)).pipe(h(e=>{let{msg:r}=e;return r&&r?.toLowerCase()?.includes("expirada")?i(()=>"SESSION_EXPIRED"):g(e)}),u({count:1,delay:1e3,resetOnSuccess:!0}),m(e=>(console.error(e),i(()=>e))))}saveInfoInProv({id:t,name:e,username:r,token:a,fecha_last_activity:o,fecha_conciliacion:p}){localStorage.setItem("providerId",t),localStorage.setItem("providerName",e),localStorage.setItem("providerUserName",r),localStorage.setItem("providerToken",a),localStorage.setItem("lastActivity",this.helperService.formatDatesWithRegex({dateStr:o})),localStorage.setItem("providerTokenConciliationDate",this.helperService.formatDatesWithRegex({dateStr:p}))}loginSession({response:t,loginProviderFormValues:e}){let{providerUsername:r}=e,{done:a,msg:o,fechaHora:p,fechaConciliacion:A,token:_,data:R}=t;if(a&&a?.toLowerCase()==="false")return void this.helperService.toastAlert({title:o.length?o:"Algo sali\xF3 mal",icon:"error",position:"top"});let{Table:[{pro_cve:E,pro_nombre:P}]}=R;this.saveInfoInProv({id:E?.toString(),name:P,username:r,token:_,fecha_last_activity:p,fecha_conciliacion:A}),this.helperService.toastAlert({title:o.length?o:"Ok",icon:"success",timer:1500}),this.router.navigate(["/"])}logoutSession(){let t=localStorage.getItem("providerId"),e=localStorage.getItem("providerToken");return!t||!e?(this.helperService.toastAlert({title:"No se ha iniciado sesi\xF3n",icon:"error",timer:1e3}),this.clearSessions(),i(()=>v)):s(()=>this.http.post(`${l.API_URL}/Logout.aspx`,{})).pipe(d(()=>this.clearSessions()),m(r=>(console.error(r),this.helperService.toastAlert({title:"Algo sali\xF3 mal",icon:"error"}),i(()=>r))))}static \u0275fac=function(e){return new(e||c)};static \u0275prov=S({token:c,factory:c.\u0275fac,providedIn:"root"})};export{y as a};
