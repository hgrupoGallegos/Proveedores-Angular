import{a as De}from"./chunk-4VQPDT6L.js";import{a as we,c as Pe}from"./chunk-SE5NYA22.js";import{a as Se}from"./chunk-4BABL3KU.js";import{a as ue,c as he,d as ge}from"./chunk-CF4FKG4D.js";import{a as Ie}from"./chunk-AJZXPOTM.js";import{a as me}from"./chunk-TVLHVE3P.js";import{a as $}from"./chunk-UGHFU27J.js";import{a as be,b as ve,c as ne,d as fe,e as xe,f as Ce,j as Oe,l as ye,r as _e,s as R,t as H}from"./chunk-LEWYKQGU.js";import{$ as E,A as D,B as X,Ca as U,Da as Z,Ea as M,Fa as Y,Ga as L,Ia as W,J as o,M as T,Na as N,Oa as V,Pa as J,Q as h,Ra as B,T as d,V as S,W as a,X as n,Y as b,a as ae,aa as v,b as oe,ba as g,ia as c,j as q,ka as p,la as ce,ma as le,na as de,oa as pe,p as se,qa as w,ra as z,sa as A,t as G,ta as F,w as m,y,z as _}from"./chunk-MMKYUMEW.js";import{f as x}from"./chunk-EQDQRRRY.js";var I=class i{http=m(W);purchaseOrdersSource=new oe([]);purchaseOrder$=this.purchaseOrdersSource.asObservable();purchaseOrderHeaders=["No. Orden","Fecha","Monto","Estatus","Cuenta bancaria","Consultar","Contacto"];purchaseOrderDetailHeaders=["Art\xEDculo","Descripci\xF3n","Cantidad","U.M.","Precio unitario","Subtotal"];getTablePaymentDetailsInvoice({items:t,includeTotal:e}){let r=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:2,maximumFractionDigits:2}),s=t.map(f=>`
                    <tr class="hover:bg-gray-50 transition-colors text-sm">
                        <td class="px-4 py-2 bg-gray-100">${f.numero}</td>
                        <td class="px-4 py-2 bg-green-100">${r.format(f.monto)}</td>
                        ${e?`
                                <td class="px-4 py-2 bg-yellow-100"></td>
                            `:""}
                    </tr>
                `).join(""),l=e?`
                <th scope="col" class="px-4 py-3"> Total </th>
            `:"",u=e?`
                <tr class="hover:bg-gray-50 transition-colors text-sm">
                    <td class="px-4 py-2"></td>
                    <td class="px-4 py-2"></td>
                    <td class="px-4 py-2 font-semibold bg-yellow-100">${r.format(t.reduce((f,C)=>f+C.monto,0))}</td>
                </tr>
            `:"";return`
            <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-md">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 text-sm font-medium text-gray-500 uppercase tracking-wider text-center">
                        <tr>
                            <th scope="col" class="px-4 py-3">
                                Orden de Compra
                            </th>
                            <th scope="col" class="px-4 py-3">
                                Monto
                            </th>
                            ${l}
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-300 text-center">
                        ${s}
                        ${u}
                    </tbody>
                </table>
            </div>
            <strong class="text-sm mt-4 text-center"> Favor de seleccionar un archivo XML </strong>
        `}getPurchaseOrderHeaders(){return[...this.purchaseOrderHeaders]}getPurchaseOrderDetailHeaders(){return[...this.purchaseOrderDetailHeaders]}formatDates(t){return ue({date:new Date(t),format:"DD-MM-YYYY",tz:"America/Mexico_City",locale:"es-MX"})}formatPurchaseOrders(t){return t.map(({noFactura:e,fecha:r,monto:s,status:l})=>({numero:e,fecha:r,monto:s,estatus:l}))}formatPurchaseOrder(t){return t.map(({noorden:e,tipoin:r,status:s,noobra:l,nombre:u,direccion:f,condiciones:C,condiciondia:k,observaciones:j,fecha:O,porfle:P,monfle:re,poriva:ie})=>({fecha:this.formatDates(O),numero:e.toString(),estatus:s.trim(),obra:l.toString(),nombre:u.trim(),direccion:f.trim(),condiciones:C,dias:k,observaciones:j.trim(),porcentajeFlete:P,porcentajeIva:ie,tipo:r,montoFlete:re}))}formatPurchaseOrderInvoice(t){return t.map(({fxp_num:e})=>({numero:e}))}formatPurchaseOrderDetail(t){return t.map(({nombre:e,descripcion:r,um:s,cant:l,precio:u,iva:f,retiva:C,retisr:k,observaciones:j})=>({articulo:e.trim(),descripcion:r.trim(),cantidad:l,um:s.trim(),precioUnitario:u,iva:f,retencionIva:C,retencionIsr:k,observaciones:j.trim(),subtotal:u*l}))}updatePurchaseOrders(t){this.purchaseOrdersSource.next(t)}purchaseOrdersRequest(){return q(()=>this.http.post(`${N.API_URL}/OrdenesCompra.aspx`,{}))}getPurchaseOrder(t){return q(()=>this.http.post(`${N.API_URL}/OrdenCompra.aspx`,t))}changeBankAccountRequst({cuenta:t,orden:e}){return q(()=>this.http.get(`${N.API_URL_EXT}/OrdenCompra/OrdenCompra/CtaBco?cta=${t}&orden=${e}`))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=G({token:i,factory:i.\u0275fac,providedIn:"root"})};var Q=class i{http=m(W);constructor(){}upXml(t,e){return x(this,null,function*(){this.http.post(`${N.API_URL_TEST}/FacturasUpload.aspx`,{params:{files:t,__facxml:t,ordenes:e,idProveedor:244,nomfac:12321,rfcGallegos:"",lastActivity:"",token:""}}).subscribe(r=>{console.log({resp:r})})})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=G({token:i,factory:i.\u0275fac,providedIn:"root"})};var ke=i=>({"border-red-600 ring-red-600":i}),Ne=i=>({"bg-gray-500":i}),Te=i=>({"hover:text-white":i}),Ve=i=>({"cursor-pointer":i}),Be=i=>({"bg-green-50 hover:bg-green-50 font-medium":i}),Re=i=>({"text-green-600 bg-green-50":i});function He(i,t){if(i&1&&c(0),i&2){let e=g();p(" ",e.textButton," ")}}function $e(i,t){i&1&&(a(0,"p",10),D(),a(1,"svg",36),b(2,"path",37)(3,"path",38),n(),c(4," Verificando datos... "),n())}function je(i,t){if(i&1&&(a(0,"span",41),c(1),n()),i&2){let e=g(2);o(),p(" ",e.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function ze(i,t){if(i&1){let e=E();a(0,"th",39),v("click",function(){let s=y(e).$implicit,l=g();return _(l.sortDataEvent(s))}),c(1),h(2,je,2,1,"span",40),n()}if(i&2){let e=t.$implicit,r=t.index,s=g();d("ngClass",w(3,Ve,s.filteredPurchaseOrders.length!==0&&s.isSortable(e))),o(),p(" ",e," "),o(),d("ngIf",s.sortColumn===s.headerNormalized[r])}}function qe(i,t){i&1&&(a(0,"tr",24)(1,"td",42),c(2," No se encontraron resultados "),n()())}function Ge(i,t){if(i&1){let e=E();a(0,"tr",25)(1,"td")(2,"input",44),v("change",function(s){let l=y(e).$implicit,u=g(2);return _(u.onSelectItem(l,s))}),n()(),a(3,"td",45),c(4),n(),a(5,"td",45),c(6),n(),a(7,"td",45),c(8),A(9,"currency"),n(),a(10,"td",46),c(11),n(),a(12,"td",45)(13,"button",47),v("click",function(){let s=y(e).$implicit,l=g(2);return _(l.bankAccount(s.numero))}),D(),a(14,"svg",48),b(15,"path",49),n()()(),X(),a(16,"td",45)(17,"button",50),v("click",function(){let s=y(e).$implicit,l=g(2);return _(l.onClickRedirectPurchaseOrder({purchaseorderNumber:s.numero,route:"/purchase-orders",prop:"number"}))}),D(),a(18,"svg",51),b(19,"path",52),n()()(),X(),a(20,"td",45)(21,"button",53),v("click",function(){let s=y(e).$implicit,l=g(2);return _(l.onClickRedirectPurchaseOrder({purchaseorderNumber:s.numero,route:"/contact",prop:"order"}))}),D(),a(22,"svg",54),b(23,"path",55),n()()()()}if(i&2){let e=t.$implicit,r=g(2);d("ngClass",w(9,Be,r.isItemSelected(e))),o(2),d("checked",r.isItemSelected(e)),o(2),p(" ",e.numero," "),o(2),p(" ",e.fecha," "),o(2),p(" ",F(9,7,e.monto)," "),o(2),d("ngClass",w(11,Re,r.isAuthorized(e.estatus))),o(),p(" ",e.estatus," ")}}function Xe(i,t){if(i&1&&h(0,Ge,24,13,"tr",43),i&2){let e=g();d("ngForOf",e.paginatedPurchaseOrders)}}function Ue(i,t){i&1&&b(0,"app-loader",56),i&2&&d("message","Obteniendo datos...")}var ee=class i{purchaseOrderService=m(I);customDatatableService=m(De);helperService=m(V);paymentDetails=m(we);datatableService=m(Se);detailsService=m(Pe);fb=m(_e);router=m(B);ocService=m(Q);purchaseOrderDatesForm=this.createPurchaseOrderDatesForm();purchaseOrderHeaders=this.purchaseOrderService.getPurchaseOrderHeaders();purchaseOrders=[];filteredPurchaseOrders=[];isActiveLoader=!1;isLoading=!1;pageSize=5;currentPage=0;sortColumn=null;searchTerm="";sortDirection=null;selectedItems=[];selectAllChecked=!1;excludeColumnsForSort=["Cuenta bancaria","Consultar","Contacto"];bankAccounts=[];headerNormalized=this.purchaseOrderHeaders.map(t=>t.includes("No. Orden")?"numero":this.helperService.normalizeText({text:t}));get fechas(){return this.purchaseOrderDatesForm.value}get textButton(){return this.isDatesInvalid?"Fechas no v\xE1lidas":this.purchaseOrderDatesForm.invalid?"Las fechas son requeridas":"Buscar"}get datesTouched(){return this.purchaseOrderDatesForm.get("fechaFin")?.invalid&&this.purchaseOrderDatesForm.get("fechaInicio")?.touched}get isDatesInvalid(){let{fechaFin:t,fechaInicio:e}=this.fechas;return he(t,e)}get isDatesAfterToday(){let{fechaFin:t}=this.fechas;return ge(t,new Date)}get totalPages(){return this.customDatatableService.getTotalPages({dataLength:this.filteredPurchaseOrders.length,pageSize:this.pageSize})}get recordsInfo(){if(this.filteredPurchaseOrders.length===0)return"No hay registros para mostrar";let{start:t,end:e,total:r}=this.customDatatableService.getPageData({currentPage:this.currentPage,pageSize:this.pageSize,dataLength:this.filteredPurchaseOrders.length});return`Mostrando ${t} - ${e} de ${r} registros`}get paginatedPurchaseOrders(){return this.customDatatableService.paginateData({data:this.filteredPurchaseOrders,currentPage:this.currentPage,pageSize:this.pageSize})}createPurchaseOrderDatesForm(){return this.fb.group({fechaInicio:["",[ne.required]],fechaFin:["",[ne.required]]})}updateSelectAllCheckboxState(){let t=this.filteredPurchaseOrders,e=t.every(r=>this.isItemSelected(r));this.selectAllChecked=t.length>0&&e}loadPurchaseOrders(){this.purchaseOrderService.purchaseOrder$.subscribe(t=>{if(t.length>0){this.purchaseOrders=t,this.filteredPurchaseOrders=[...this.purchaseOrders];let e=localStorage.getItem("details.bankAccounts");this.bankAccounts=e?JSON.parse(e):[],(!e||this.bankAccounts.length===0)&&this.detailsService.detailRequest().subscribe({next:r=>{this.bankAccounts=this.paymentDetails.formatPaymentDetails(r.datosPago.Table)}})}})}ngOnInit(){this.loadPurchaseOrders()}changePage(t){this.currentPage=t,this.updateSelectAllCheckboxState()}searchInputEvent(t){this.filteredPurchaseOrders=this.customDatatableService.filterData({target:t.target,data:this.purchaseOrders,columnsToFilter:["numero"]}),this.changePage(0)}isSortable(t){return this.customDatatableService.isSortableColumn({exludeColumns:this.excludeColumnsForSort,column:t})}sortDataEvent(t){if(!this.isSortable(t)||this.filteredPurchaseOrders.length===0)return;let e=t.includes("No. Orden")?"numero":this.helperService.normalizeText({text:t}),{data:r,sortColumn:s,sortDirection:l}=this.customDatatableService.sortData({column:e,data:this.purchaseOrders,sortColumn:this.sortColumn,sortDirection:this.sortDirection});this.filteredPurchaseOrders=r,this.sortColumn=s,this.sortDirection=l}isAuthorized(t){return t.toLowerCase().includes("autorizada")}onClickSelectAllCheckBox(t){let e=t.target;this.selectAllChecked=e.checked,this.selectedItems=this.selectAllChecked?[...this.filteredPurchaseOrders]:[]}isItemSelected(t){return this.selectedItems.some(e=>e.numero===t.numero)}onSelectItem(t,e){if(!e.target.checked)return this.selectedItems=this.selectedItems.filter(s=>s.numero!==t.numero),void this.updateSelectAllCheckboxState();this.isItemSelected(t)||this.selectedItems.push(t),this.updateSelectAllCheckboxState()}invoiceValidation(t){return x(this,null,function*(){if(!t)return this.helperService.swal.showValidationMessage("Debes seleccionar un archivo XML");if(!t.name.toLowerCase().includes(".xml"))return this.helperService.swal.showValidationMessage("El archivo debe ser un XML")})}uploadInvoice(){}selectInvoice(){if(this.selectedItems.length===0)return void this.helperService.toastAlert({title:"Favor de seleccionar al menos una orden de compra",icon:"error",timer:2e3});let t=this.helperService.getConfigModal({title:"Subir Factura",confirmButtonText:"Subir",showConfirmButton:!0,cancelButtonText:"Cancelar",showCancelButton:!0,width:"50%",html:this.purchaseOrderService.getTablePaymentDetailsInvoice({items:this.selectedItems,includeTotal:!0}),input:"file",inputPlaceholder:"Selecciona un archivo XML",inputAttributes:{accept:"application/xml, text/xml, .xml","aria-label":"Selecciona un archivo XML"},preConfirm:e=>x(this,null,function*(){console.log({data:e}),yield this.invoiceValidation(e)})});this.helperService.toastAlert(t,e=>x(this,null,function*(){if(!e.isConfirmed)return void this.helperService.swal.close();console.log("Archivo subido:",e),console.log("ordenes",this.selectedItems);let r=this.ocService.upXml(e,this.selectedItems);console.log(r)}))}bankValidation(t){return x(this,null,function*(){if(!t)return this.helperService.swal.showValidationMessage("La cuenta es requerida")})}bankProcess({result:t,numero:e}){if(!t.isConfirmed)return this.helperService.swal.close();let r=this.bankAccounts.find(s=>s.cuenta===t.value);if(!r)return void this.helperService.toastAlert({title:"Error",text:"No se encontr\xF3 la cuenta bancaria seleccionada",icon:"error",timer:2e3});this.purchaseOrderService.changeBankAccountRequst({cuenta:r.cuenta,orden:e}).subscribe({complete:()=>{this.helperService.toastAlert({title:"La cuenta bancaria ha sido cambiada exitosamente",text:`N\xFAmero de cuenta: ${r.cuenta}`,icon:"success",timer:2500})},error:s=>{console.error("Error al cambiar la cuenta bancaria:",s),this.helperService.toastAlert({title:"Error",text:"Algo sali\xF3 mal, intenta de nuevo",icon:"error",timer:2e3})}})}bankAccount(t){let e={},r=this.bankAccounts.length===0?"Sin cuentas bancarias disponibles":"Seleccione una cuenta bancaria",s=this.bankAccounts.find(u=>u.preferente);this.bankAccounts.forEach(u=>{e[u.cuenta]=u.cuenta});let l=this.helperService.getConfigModal({title:"Consulta de cuenta bancaria",text:`N\xFAmero de \xF3rden: ${t}`,confirmButtonText:"Aplicar",showConfirmButton:!0,cancelButtonText:"Cancelar",showCancelButton:!0,input:"select",inputPlaceholder:r,inputOptions:e,inputValue:s?.cuenta??null,preConfirm:u=>x(this,null,function*(){return yield this.bankValidation(u)})});this.helperService.toastAlert(l,u=>this.bankProcess({result:u,numero:t}))}onClickRedirectPurchaseOrder({purchaseorderNumber:t,route:e,prop:r}){let s=()=>this.router.navigate([e],{queryParams:{[r]:t}});if(!e.includes("contact"))return void s();this.isActiveLoader=!0,setTimeout(()=>{this.isActiveLoader=!1,s()},250)}findByDates(){if(this.isLoading=!0,this.isDatesInvalid)return this.isLoading=!1,void this.helperService.toastAlert({title:"Rango de fechas no v\xE1lido, intente de nuevo",icon:"error",timer:2e3});if(this.isDatesAfterToday)return this.isLoading=!1,void this.helperService.toastAlert({title:"Favor de seleccionar una fecha anterior al d\xEDa de hoy",icon:"error",timer:2e3});let{fechaInicio:t,fechaFin:e}=this.fechas;setTimeout(()=>{this.isLoading=!1,this.isActiveLoader=!0,setTimeout(()=>{this.filteredPurchaseOrders=this.datatableService.filterDataByRangeDate({fechaInicio:t,fechaFin:e,data:this.purchaseOrders}),this.changePage(0),this.isActiveLoader=!1},1500)},1e3)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=T({type:i,selectors:[["app-tabla-ordenes-compra"]],decls:49,vars:27,consts:[[1,"bg-white","rounded-lg","shadow-xl","p-6","max-w-6xl","mx-auto","mb-2"],[1,"max-w-full","mx-auto","space-y-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-2",3,"formGroup"],[1,"flex","flex-col","justify-between"],[1,"space-y-1"],[1,"block","text-sm","font-medium","text-gray-700"],["type","date","formControlName","fechaInicio",1,"w-full","p-2","border","border-gray-300","rounded-lg","focus:ring-green-600","focus:border-green-600",3,"ngClass"],["type","date","formControlName","fechaFin",1,"w-full","p-2","border","border-gray-300","rounded-lg","focus:ring-green-600","focus:border-green-600",3,"ngClass"],[1,"flex","flex-col","justify-end"],[1,"bg-green-600","text-white","px-4","py-2","rounded-lg","hover:bg-green-700","transition-colors","disabled:bg-gray-500",3,"click","disabled","ngClass"],[1,"flex","items-center","justify-center"],[1,"bg-white","rounded-lg","shadow-xl","p-6","max-w-6xl","mx-auto"],[1,"flex","items-start","justify-start","mb-4"],[1,"bg-green-600","text-white","px-4","py-3","rounded-lg","hover:bg-green-700","transition-colors","disabled:bg-gray-500",3,"click","disabled"],[1,"bg-yellow-100","text-yellow-800","px-4","py-3","rounded-lg","ml-2","flex-1"],[1,"max-w-full","mx-auto","space-y-4"],[1,"flex-1"],["type","text","placeholder","Buscar ordenes de compra por n\xFAmero de orden",1,"w-full","p-2","border","border-gray-300","rounded-lg","focus:ring-green-600","focus:border-green-600",3,"input"],[1,"overflow-x-auto","rounded-lg","border","border-gray-300","custom-scrollbar"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-green-600","text-white","uppercase","sticky","top-0","z-10"],["type","checkbox",1,"ml-4","form-checkbox","checkbox","bg-gray-50","text-green-600","shadow-sm","rounded","border-gray-400",3,"ngModelChange","change","ngModel","disabled"],["class","px-6 py-3 text-center text-sm font-medium tracking-wider",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"bg-white","divide-y","divide-gray-200"],[1,"text-center"],[1,"border-b","hover:bg-gray-50","text-center",3,"ngClass"],[1,"flex","justify-between","items-center","mt-4"],[1,"text-sm","text-gray-700"],[1,"inline-flex","-space-x-px","text-sm"],[1,"flex","items-center","justify-center","px-3","py-2","rounded-l-lg","bg-white","border","border-gray-300","text-gray-500","hover:bg-green-600","transition-colors","disabled:bg-gray-300",3,"click","disabled","ngClass"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 6 10",1,"w-3.5","h-3.5","me-2","rtl:rotate-180"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 1 1 5l4 4"],[1,"flex","items-center","justify-center","px-3","py-2","rounded-r-lg","bg-white","border","border-gray-300","text-gray-500","hover:bg-green-600","transition-colors","disabled:bg-gray-300",3,"click","disabled","ngClass"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 6 10",1,"w-3.5","h-3.5","ms-2","rtl:rotate-180"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 9 4-4-4-4"],[3,"message",4,"ngIf"],["aria-hidden","true","role","status","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"inline","w-4","h-4","me-3","text-white","animate-spin"],["d","M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z","fill","#E5E7EB"],["d","M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z","fill","currentColor"],[1,"px-6","py-3","text-center","text-sm","font-medium","tracking-wider",3,"click","ngClass"],["class","ml-1",4,"ngIf"],[1,"ml-1"],["colspan","9",1,"px-3","py-2"],["class","border-b hover:bg-gray-50 text-center",3,"ngClass",4,"ngFor","ngForOf"],["type","checkbox",1,"ml-4","form-checkbox","checkbox","bg-gray-50","text-green-600","shadow-sm","rounded","border-gray-400",3,"change","checked"],[1,"px-3","py-2"],[1,"px-3","py-2",3,"ngClass"],[1,"border","border-yellow-300","rounded-lg","bg-yellow-50",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",1,"w-6","h-6","text-yellow-600","text-center","cursor-pointer","inline-block"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","m14.304 4.844 2.852 2.852M7 7H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-4.5m2.409-9.91a2.017 2.017 0 0 1 0 2.853l-6.844 6.844L8 14l.713-3.565 6.844-6.844a2.015 2.015 0 0 1 2.852 0Z"],[1,"border","border-green-300","rounded-lg","bg-green-50",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",1,"w-6","h-6","text-green-600","text-center","cursor-pointer","inline-block"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M10 3v4a1 1 0 0 1-1 1H5m8 7.5 2.5 2.5M19 4v16a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7.914a1 1 0 0 1 .293-.707l3.914-3.914A1 1 0 0 1 9.914 3H18a1 1 0 0 1 1 1Zm-5 9.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0Z"],[1,"border","border-blue-300","rounded-lg","bg-blue-50",3,"click"],["fill","none","stroke","currentColor","stroke-width","2","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-6","h-6","text-blue-600","text-center","cursor-pointer","inline-block"],["stroke-linecap","round","stroke-linejoin","round","d","M16.5 9.4L12 13.5 7.5 9.4M3 7c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V7z"],[3,"message"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),c(6," Fecha de inicio "),n(),b(7,"input",6),n()(),a(8,"div",3)(9,"div",4)(10,"label",5),c(11," Fecha de fin "),n(),b(12,"input",7),n()(),a(13,"div",8)(14,"button",9),v("click",function(){return r.findByDates()}),h(15,He,1,1)(16,$e,5,0,"p",10),n()()()()(),a(17,"div",11)(18,"div",12)(19,"button",13),v("click",function(){return r.selectInvoice()}),c(20," Subir factura "),n(),a(21,"div",14),c(22," * Recuerda que para subir una factura, primero debes seleccionar una o m\xE1s ordenes de compra. "),n()(),a(23,"div",15)(24,"div",16)(25,"input",17),v("input",function(l){return r.searchInputEvent(l)}),n()(),a(26,"div",18)(27,"table",19)(28,"thead",20)(29,"tr")(30,"th")(31,"input",21),pe("ngModelChange",function(l){return de(r.selectAllChecked,l)||(r.selectAllChecked=l),l}),v("change",function(l){return r.onClickSelectAllCheckBox(l)}),n()(),h(32,ze,3,5,"th",22),n()(),a(33,"tbody",23),h(34,qe,3,0,"tr",24)(35,Xe,1,1,"tr",25),n()()(),a(36,"div",26)(37,"span",27),c(38),n(),a(39,"ul",28)(40,"li")(41,"button",29),v("click",function(){return r.changePage(r.currentPage-1)}),D(),a(42,"svg",30),b(43,"path",31),n()()(),X(),a(44,"li")(45,"button",32),v("click",function(){return r.changePage(r.currentPage+1)}),D(),a(46,"svg",33),b(47,"path",34),n()()()()()()(),h(48,Ue,1,1,"app-loader",35)),e&2&&(o(2),d("formGroup",r.purchaseOrderDatesForm),o(5),d("ngClass",w(17,ke,r.datesTouched||r.isDatesInvalid||r.isDatesAfterToday)),o(5),d("ngClass",w(19,ke,r.datesTouched||r.isDatesInvalid||r.isDatesAfterToday)),o(2),d("disabled",r.purchaseOrderDatesForm.invalid)("ngClass",w(21,Ne,r.isDatesInvalid)),o(),S(r.isLoading?16:15),o(4),d("disabled",r.selectedItems.length===0),o(12),le("ngModel",r.selectAllChecked),d("disabled",r.filteredPurchaseOrders.length===0),o(),d("ngForOf",r.purchaseOrderHeaders),o(2),S(r.filteredPurchaseOrders.length===0?34:35),o(4),p(" ",r.recordsInfo," "),o(3),d("disabled",r.currentPage===0)("ngClass",w(23,Te,r.currentPage>0)),o(4),d("disabled",r.currentPage>=r.totalPages-1)("ngClass",w(25,Te,r.currentPage<r.totalPages-1)),o(3),d("ngIf",r.isActiveLoader))},dependencies:[L,U,Z,M,Y,R,ve,be,fe,xe,Ce,H,Oe,ye,$],encapsulation:2})};var Ze=(i,t)=>({"mt-1":i,"mt-3":t}),Ye=(i,t)=>({"border-b pb-2":i,"pt-2":t}),We=(i,t)=>({"font-semibold":i,"font-medium":t}),Je=(i,t)=>({"font-semibold":i,"font-mono":t});function Ke(i,t){if(i&1&&(a(0,"div",27)(1,"div")(2,"p",28)(3,"span",29),c(4,"Estatus: "),n(),a(5,"span",30),c(6),n()(),a(7,"p",28)(8,"span",29),c(9,"Fecha:"),n(),c(10),n(),a(11,"p",28)(12,"span",29),c(13,"N\xFAmero de orden:"),n(),c(14),n(),a(15,"p",28)(16,"span",29),c(17,"Obra:"),n(),c(18),n(),a(19,"p",28)(20,"span",29),c(21,"Condiciones de compra:"),n(),c(22),n(),a(23,"p",31)(24,"span",29),c(25,"Direcci\xF3n de entrega:"),n()(),a(26,"p",32),c(27),n()(),a(28,"div")(29,"p",33)(30,"span",29),c(31,"Observaciones:"),n()(),a(32,"textarea",34),c(33,"                "),n()()()),i&2){let e=g();o(6),p(" ",e.purchaseOrderData.estatus," "),o(4),p(" ",e.purchaseOrderData.fecha," "),o(4),p(" ",e.purchaseOrderData.numero," "),o(4),ce(" ",e.purchaseOrderData.obra," - ",e.purchaseOrderData.nombre," "),o(4),p(" ",e.conditions," "),o(5),p(" ",e.purchaseOrderData.direccion," "),o(5),d("value",e.purchaseOrderData.observaciones.length===0?"":e.purchaseOrderData.observaciones)("placeholder",e.purchaseOrderData.observaciones.length===0?"Sin observaciones":"")}}function Qe(i,t){if(i&1){let e=E();a(0,"button",35),v("click",function(){y(e);let s=g();return _(s.selectInvoice())}),c(1," Subir factura "),n()}}function et(i,t){if(i&1&&(a(0,"div")(1,"p")(2,"span",29),c(3,"Factura: "),n(),c(4),n()()),i&2){let e=g();o(4),p(" ",e.purchaseOrderInvoice.numero," ")}}function tt(i,t){if(i&1&&(a(0,"th",36),c(1),n()),i&2){let e=t.$implicit;o(),p(" ",e," ")}}function rt(i,t){if(i&1&&(b(0,"br"),a(1,"strong"),c(2,"Observaciones: "),n(),c(3)),i&2){let e=g().$implicit;o(3),p(" ",e.observaciones," ")}}function it(i,t){if(i&1&&(a(0,"tr",37)(1,"td",38),c(2),n(),a(3,"td",36),c(4),h(5,rt,4,1),n(),a(6,"td",39),c(7),n(),a(8,"td",36),c(9),n(),a(10,"td",39),c(11),A(12,"currency"),n(),a(13,"td",39),c(14),A(15,"currency"),n()()),i&2){let e=t.$implicit;o(2),p(" ",e.articulo," "),o(2),p(" ",e.descripcion," "),o(),S(e.observaciones.length>0?5:-1),o(2),p(" ",e.cantidad," "),o(2),p(" ",e.um," "),o(2),p(" ",F(12,7,e.precioUnitario)," "),o(3),p(" ",F(15,9,e.subtotal)," ")}}function nt(i,t){if(i&1){let e=E();a(0,"span",40),c(1),n(),a(2,"button",41),v("click",function(){y(e);let s=g();return _(s.uploadComprobanteEntrega())}),c(3," GUARDAR "),n()}if(i&2){let e=g();o(),p(" ",e.selectedFile.name," ")}}function at(i,t){if(i&1&&(a(0,"div",44)(1,"span",7),c(2),n(),a(3,"span",7),c(4),A(5,"currency"),n()()),i&2){let e=t.$implicit;d("ngClass",z(7,Ye,e.name==="Ret. ISR",e.name==="TOTAL")),o(),d("ngClass",z(10,We,e.name==="TOTAL",e.name==="SUBTOTAL")),o(),p(" ",e.name," "),o(),d("ngClass",z(13,Je,e.name==="TOTAL",e.name!=="TOTAL")),o(),p(" ",F(5,5,e.value)," ")}}function ot(i,t){if(i&1&&(a(0,"div",42),h(1,at,6,16,"div",43),n()),i&2){let e=g();o(),d("ngForOf",e.purchaseOrderPaymentDetails)}}function st(i,t){i&1&&b(0,"app-loader",45),i&2&&d("message","Obteniendo datos...")}var te=class i{purchaseOrderService=m(I);helperService=m(V);route=m(J);authService=m(me);router=m(B);isActiveLoader=!1;destroy$=new ae;selectedFile=null;purchaseOrderDetailHeaders=this.purchaseOrderService.getPurchaseOrderDetailHeaders();purchaseOrder=[];invoices=[];purchaseOrderDetails=[];get purchaseOrderInvoice(){let[t]=this.invoices;return t}get purchaseOrderData(){let[t]=this.purchaseOrder;return t}get existPurchaseOrderData(){return this.purchaseOrderData&&Object.keys(this.purchaseOrderData).length>0}get conditions(){return this.purchaseOrderData.condiciones===1?"Contra Entrega":`Cr\xE9dito a ${this.purchaseOrderData.dias} d\xEDas`}get existsInfo(){return this.existPurchaseOrderData&&this.purchaseOrderPaymentDetails.length>0&&this.purchaseOrderDetails.length>0}get purchaseOrderPaymentDetails(){let t=this.purchaseOrderDetails.map(({cantidad:O,precioUnitario:P,iva:re,retencionIva:ie,retencionIsr:Me,subtotal:Le})=>({cantidad:O,precioUnitario:P,iva:re,retencionIva:ie,retencionIsr:Me,subtotal:Le})),{porcentajeFlete:e,porcentajeIva:r}=this.purchaseOrderData,{iva:s,retencionIsr:l,retencionIva:u,subtotal:f}=t.reduce((O,P)=>({iva:O.iva+P.iva,retencionIva:O.retencionIva+P.retencionIva,retencionIsr:O.retencionIsr+P.retencionIsr,subtotal:O.subtotal+P.subtotal}),{iva:0,retencionIva:0,retencionIsr:0,subtotal:0}),C=0;e>0&&(C=(f+s-u-l)*e/100);let k=s+C*r,j=f+k-u-l+C;return[{name:"SUBTOTAL",value:f},{name:"FLETE",value:C},{name:"IVA",value:k},{name:"Ret. IVA",value:u},{name:"Ret. ISR",value:l},{name:"TOTAL",value:j}]}loadPurchaseOrder(t){this.purchaseOrderService.getPurchaseOrder(t).subscribe({next:e=>{if(e.token.toLowerCase().includes("invalid"))return this.isActiveLoader=!1,void this.authService.logoutSession().subscribe({complete:()=>this.helperService.toastAlert({title:"Sesion Expirada",icon:"warning",timer:2e3,position:"top"})});let{datosOrden:{Table:r},detalleOrden:{Table:s},facturas:{Table:l}}=e;this.purchaseOrder=this.purchaseOrderService.formatPurchaseOrder(r),this.invoices=this.purchaseOrderService.formatPurchaseOrderInvoice(l),this.purchaseOrderDetails=this.purchaseOrderService.formatPurchaseOrderDetail(s)},complete:()=>{this.isActiveLoader=!1},error:e=>{this.isActiveLoader=!1,console.error("Error al obtener las \xF3rdenes de compra:",e),this.helperService.toastAlert({title:"Error, no se pudieron obtener las \xF3rdenes de compra",icon:"error",timer:2e3})}})}ngOnInit(){this.isActiveLoader=!0,this.route.queryParams.pipe(se(this.destroy$)).subscribe(t=>{let e=t.number;if(!e){this.isActiveLoader=!1;return}let r=new FormData;r.append("noorden",e),this.loadPurchaseOrder(r)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onFileSelected(t){let e=t.target.files[0];this.selectedFile=e??null}uploadInvoice(){}uploadComprobanteEntrega(){}invoiceValidation(t){return x(this,null,function*(){if(!t)return this.helperService.swal.showValidationMessage("Debes seleccionar un archivo XML");if(!t.name.toLowerCase().includes(".xml"))return this.helperService.swal.showValidationMessage("El archivo debe ser un XML")})}selectInvoice(){let{value:t}=this.purchaseOrderPaymentDetails.find(r=>r.name.toLowerCase()==="total"),e=this.helperService.getConfigModal({title:"Subir Factura",confirmButtonText:"Subir",showConfirmButton:!0,cancelButtonText:"Cancelar",showCancelButton:!0,width:"50%",html:this.purchaseOrderService.getTablePaymentDetailsInvoice({items:[{numero:this.purchaseOrderData.numero.toString(),monto:t}],includeTotal:!1}),input:"file",inputPlaceholder:"Selecciona un archivo",inputAttributes:{accept:"application/xml, text/xml, .xml","aria-label":"Selecciona un archivo XML"},preConfirm:r=>x(this,null,function*(){return yield this.invoiceValidation(r)})});this.helperService.toastAlert(e,r=>{if(!r.isConfirmed)return void this.helperService.swal.close();console.log("Archivo subido:",r.value)})}onBack(){this.router.navigate([],{queryParams:{number:null},queryParamsHandling:"merge"})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=T({type:i,selectors:[["app-orden-compra"]],decls:36,vars:11,consts:[[1,"bg-white","rounded-lg","shadow-xl","p-4","mx-auto","printable-area","print:shadow-none"],[1,"mb-3","border-b","pb-4"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-bold","text-gray-800"],[1,"flex","justify-between","items-center","mb-3"],[1,"bg-red-50","border-red-600","border","text-red-700","hover:bg-gray-100","transition-colors","px-4","py-2","rounded-lg","text-sm","font-medium",3,"click"],["class","grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",4,"ngIf"],[3,"ngClass"],[1,"bg-green-600","hover:bg-green-700","px-4","py-2","rounded-lg","text-sm","font-medium","text-white","transition-colors","disabled:bg-gray-500"],[1,"mb-3","pb-4","pt-2","p-4"],[1,"overflow-x-auto","border","border-gray-300","rounded-lg"],[1,"min-w-full","divide-y","divide-gray-300"],[1,"bg-gray-50"],[1,"text-center","text-xs","font-semibold","text-gray-600","uppercase","bg-gray-100"],["class","px-4 py-3",4,"ngFor","ngForOf"],[1,"bg-white","divide-y","divide-gray-200","text-center","text-sm"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-8","mb-3","pb-4","pt-2","p-4"],[1,"space-y-4"],[1,"flex","items-center","gap-2"],[1,"bg-green-50","border-green-600","border","text-green-700","hover:bg-green-100","transition-colors","px-6","py-2","rounded-md","text-sm","font-medium","w-fit","relative","overflow-hidden","cursor-pointer"],[1,"font-semibold","text-xs","cursor-pointer"],["type","file","name","file_source","size","40",1,"absolute","z-2","top-0","left-0","opacity-0","cursor-pointer",3,"change"],["onclick","window.print()",1,"bg-green-50","border-green-600","border","text-green-700","hover:bg-green-100","transition-colors","px-6","py-2","rounded-md","text-sm","font-medium","w-fit"],["class","space-y-2 text-sm border p-3 border-gray-300 rounded-lg",4,"ngIf"],[1,"hidden","print:block","text-xs","text-center","italic","mt-4"],[3,"message",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm"],[1,"mb-2"],[1,"font-semibold"],[1,"bg-green-100","text-green-800","px-2","py-1","rounded-full","text-center","text-sm","font-medium"],[1,"mt-2"],[1,"mt-1"],[1,"mb-1"],[1,"w-full","h-32","p-2","border","border-gray-300","rounded-md","text-sm",3,"value","placeholder"],[1,"bg-green-600","hover:bg-green-700","px-4","py-2","rounded-lg","text-sm","font-medium","text-white","transition-colors","disabled:bg-gray-500",3,"click"],[1,"px-4","py-3"],[1,"hover:bg-gray-50"],[1,"px-4","py-3","font-semibold"],[1,"px-4","py-3","font-mono"],[1,"text-sm","text-gray-700"],[1,"bg-green-600","hover:bg-green-700","text-white","transition-colors","px-6","py-2","rounded-md","text-xs","font-medium","w-fit",3,"click"],[1,"space-y-2","text-sm","border","p-3","border-gray-300","rounded-lg"],["class","flex justify-between",3,"ngClass",4,"ngFor","ngForOf"],[1,"flex","justify-between",3,"ngClass"],[3,"message"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),c(5," Detalles de la orden de compra "),n()(),a(6,"div",4)(7,"button",5),v("click",function(){return r.onBack()}),c(8," Regresar "),n()()(),h(9,Ke,34,9,"div",6),a(10,"div",7),h(11,Qe,2,0,"button",8)(12,et,5,1,"div"),n()(),a(13,"div",9)(14,"div",10)(15,"table",11)(16,"thead",12)(17,"tr",13),h(18,tt,2,1,"th",14),n()(),a(19,"tbody",15),h(20,it,16,11,"tr",16),n()()()(),a(21,"div",17)(22,"div",18)(23,"div",19)(24,"a",20)(25,"span",21),c(26," ADJUNTAR COMPROBANTE DE ENTREGA "),n(),a(27,"input",22),v("change",function(l){return r.onFileSelected(l)}),n()(),h(28,nt,4,1),n(),a(29,"button",23),c(30," IMPRIMIR "),n()(),h(31,ot,2,1,"div",24),n(),a(32,"h6",25)(33,"strong"),c(34," Esta impresi\xF3n carece de valor fiscal y/o legal. \xDAnicamente para efectos informativos "),n()()(),h(35,st,1,1,"app-loader",26)),e&2&&(o(9),d("ngIf",r.existsInfo),o(),d("ngClass",z(8,Ze,r.invoices.length>0,r.invoices.length===0)),o(),S(r.invoices.length===0?11:12),o(7),d("ngForOf",r.purchaseOrderDetailHeaders),o(2),d("ngForOf",r.purchaseOrderDetails),o(8),S(r.selectedFile?28:-1),o(3),d("ngIf",r.existsInfo),o(4),d("ngIf",r.isActiveLoader))},dependencies:[L,U,Z,M,Y,H,R,$],styles:["@media print{body[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{visibility:hidden;margin:0;padding:0}.printable-area[_ngcontent-%COMP%], .printable-area[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{visibility:visible}.printable-area[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%}table[_ngcontent-%COMP%]{width:100%!important;border-collapse:collapse}button[_ngcontent-%COMP%], input[_ngcontent-%COMP%], .no-print[_ngcontent-%COMP%]{display:none!important}}"]})};function ct(i,t){i&1&&b(0,"app-orden-compra")}function lt(i,t){i&1&&b(0,"app-tabla-ordenes-compra")}function dt(i,t){i&1&&b(0,"app-loader",3),i&2&&d("message","Obteniendo datos...")}var Fe=class i{helperService=m(V);purchaseOrderService=m(I);route=m(J);router=m(B);purchaseOrders=[];isActiveLoader=!1;title="\xD3rdenes de compra";orderNumber=null;showInitialMessage(){this.helperService.toastAlert({title:"Para consultar tus \xF3rdenes de compra, selecciona un rango de fechas",icon:"info",timer:2500,timerProgressBar:!0})}navigateToOrders(){return void this.router.navigate([],{queryParams:{number:null},queryParamsHandling:"merge"})}loadPurchaseOrders(){this.isActiveLoader=!0,this.purchaseOrderService.purchaseOrdersRequest().subscribe({next:t=>{this.purchaseOrders=this.purchaseOrderService.formatPurchaseOrders(t),this.purchaseOrderService.updatePurchaseOrders(this.purchaseOrders)},complete:()=>{this.isActiveLoader=!1,this.route.queryParams.subscribe(t=>{if(this.orderNumber=t.number,!this.orderNumber)return this.showInitialMessage(),void this.navigateToOrders();let e=this.purchaseOrders.find(r=>r.numero===this.orderNumber);if(this.orderNumber=e?.numero??null,!e||!this.orderNumber)return this.showInitialMessage(),void this.navigateToOrders()})},error:t=>{this.isActiveLoader=!1,console.error("Error al obtener las \xF3rdenes de compra:",t),this.helperService.toastAlert({title:"Error, no se pudieron obtener las \xF3rdenes de compra",icon:"error",timer:2e3})}})}ngOnInit(){this.loadPurchaseOrders()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=T({type:i,selectors:[["app-ordenes-compra"]],decls:5,vars:3,consts:[[3,"titleSection"],[1,"mb-8"],[3,"message",4,"ngIf"],[3,"message"]],template:function(e,r){e&1&&(a(0,"app-panel",0)(1,"div",1),h(2,ct,1,0,"app-orden-compra")(3,lt,1,0,"app-tabla-ordenes-compra"),n(),h(4,dt,1,1,"app-loader",2),n()),e&2&&(d("titleSection",r.title),o(2),S(r.orderNumber&&r.orderNumber!==""?2:3),o(2),d("ngIf",r.isActiveLoader))},dependencies:[Ie,L,M,H,R,ee,te,$],styles:[`tr{height:40px}td,th{padding-top:.4rem!important;padding-bottom:.4rem!important}.divide-y>*+*{border-top-width:1px}.custom-scrollbar::-webkit-scrollbar{width:6px;height:6px}
`],encapsulation:2})};export{Fe as OrdenesCompraComponent};
