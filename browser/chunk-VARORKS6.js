import{a as ce}from"./chunk-4VQPDT6L.js";import{a as oe}from"./chunk-4BABL3KU.js";import{c as X,d as q}from"./chunk-CF4FKG4D.js";import{a as se}from"./chunk-AJZXPOTM.js";import"./chunk-TVLHVE3P.js";import{b as J,d as K,e as Q,j as W,k as Y,l as Z,m as ee,n as te,o as ie,r as re,s as ae,t as ne}from"./chunk-LEWYKQGU.js";import{$ as E,A as F,B as A,Ca as j,Da as L,Ea as z,Fa as R,Ga as G,Ia as H,J as o,M as N,Na as U,Oa as $,Q as g,T as l,V as O,W as n,X as a,Y as f,aa as h,ba as m,ia as c,ka as d,qa as v,ra as B,sa as V,t as k,ta as M,w as p,y as _,z as y}from"./chunk-MMKYUMEW.js";import{a as I,c as T,f as C}from"./chunk-EQDQRRRY.js";var w=["Todas","En revisi\xF3n","Programada para pago","Pagada parcial","Pagada"],D=["En proceso de cancelaci\xF3n","Cancelada","Rechazada"],le=[...w,...D];var b=class r{http=p(H);allInvoices=[{numero:"123257FA40",fecha:"29/01/2025",monto:7372.97,estatus:"Programada para pago"},{numero:"123257F4A0",fecha:"29/01/2025",monto:7372.97,estatus:"Pagada"},{numero:"123259F197",fecha:"29/01/2025",monto:8769.6,estatus:"Pagada"},{numero:"2423933FEB",fecha:"30/01/2025",monto:1994.84,estatus:"En proceso de cancelaci\xF3n"},{numero:"2201190B87",fecha:"18/02/2025",monto:3477.06,estatus:"Pagada"},{numero:"740517C616",fecha:"18/02/2025",monto:4139.86,estatus:"Programada para pago"},{numero:"2379488B27",fecha:"18/02/2025",monto:2905.8,estatus:"Programada para pago"},{numero:"250239F80A",fecha:"18/02/2025",monto:31351.32,estatus:"Programada para pago"},{numero:"7336323506",fecha:"18/02/2025",monto:22522.98,estatus:"Programada para pago"},{numero:"236843D7D2",fecha:"18/02/2025",monto:16168.98,estatus:"Programada para pago"},{numero:"20505247AD",fecha:"18/02/2025",monto:4914.05,estatus:"Pagada"},{numero:"72637BAED8",fecha:"18/02/2025",monto:22019.64,estatus:"Programada para pago"},{numero:"17814862FE",fecha:"18/02/2025",monto:2134.99,estatus:"Pagada"},{numero:"1780322BAB",fecha:"18/02/2025",monto:7414.5,estatus:"Pagada"}];columnsInvoiceDataTable=["No. de factura","Fecha","Monto","Estatus","Acciones"];statusOptions=[...le];getInvoices(){return[...this.allInvoices]}getColumnsInvoiceDataTable(){return[...this.columnsInvoiceDataTable]}getStatusOptions(){return[...this.statusOptions]}getInvoicesRequest(e){return this.http.post(`${U.API_URL}/Facturas.aspx`,e)}static \u0275fac=function(i){return new(i||r)};static \u0275prov=k({token:r,factory:r.\u0275fac,providedIn:"root"})};var ue=r=>({"border-red-600 ring-red-600":r}),ge=r=>({"bg-gray-500":r}),de=r=>({"hover:text-white":r}),ve=r=>({"cursor-pointer":r}),fe=(r,e)=>({"text-green-600 bg-green-50":r,"text-red-600 bg-red-50":e});function he(r,e){if(r&1&&(n(0,"option",34),c(1),a()),r&2){let i=e.$implicit;l("value",i),o(),d(" ",i," ")}}function be(r,e){if(r&1&&(n(0,"span",37),c(1),a()),r&2){let i=m(2);o(),d(" ",i.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function Se(r,e){if(r&1){let i=E();n(0,"th",35),h("click",function(){let s=_(i).$implicit,u=m();return y(u.sortDataEvent(s))}),c(1),g(2,be,2,1,"span",36),a()}if(r&2){let i=e.$implicit,t=e.index,s=m();l("ngClass",v(3,ve,s.filteredInvoices.length!==0&&s.isSortable(i))),o(),d(" ",i," "),o(),l("ngIf",s.sortColumn===s.headerNormalized[t])}}function xe(r,e){r&1&&(n(0,"tr",23)(1,"td",38),c(2," No se encontraron resultados "),a()())}function Ie(r,e){if(r&1){let i=E();n(0,"button",43),h("click",function(){_(i);let s=m().$implicit,u=m(2);return y(u.cancelInvoice(s))}),c(1," Cancelar "),a()}}function Ce(r,e){if(r&1&&(n(0,"tr",24)(1,"td",40),c(2),a(),n(3,"td",40),c(4),a(),n(5,"td",40),c(6),V(7,"currency"),a(),n(8,"td",41),c(9),a(),n(10,"td",40),g(11,Ie,2,0,"button",42),a()()),r&2){let i=e.$implicit,t=m(2);o(2),d(" ",i.numero," "),o(2),d(" ",i.fecha," "),o(2),d(" ",M(7,6,i.monto)," "),o(2),l("ngClass",B(8,fe,t.isSuccessInvoice(i),t.isCancelledInvoice(i))),o(),d(" ",i.estatus," "),o(2),l("ngIf",t.isSuccessInvoice(i))}}function _e(r,e){if(r&1&&g(0,Ce,12,11,"tr",39),r&2){let i=m();l("ngForOf",i.paginatedInvoices)}}var pe=class r{customDatatableService=p(ce);facturasService=p(b);helperService=p($);dataTableService=p(oe);fb=p(re);title="Consulta de facturas";isActiveLoader=!1;pageSize=5;isLoading=!1;currentPage=0;sortColumn=null;searchTerm="";sortDirection=null;invoiceForm=this.createInvoiceForm();allInvoices=this.facturasService.getInvoices();filteredInvoices=[...this.allInvoices];invoiceStatus=this.facturasService.getStatusOptions();invoiceHeaders=this.facturasService.getColumnsInvoiceDataTable();excludeColumnsForSort=["Acciones"];headerNormalized=this.invoiceHeaders.map(e=>e.includes("No. de factura")?"numero":this.helperService.normalizeText({text:e}));get fechas(){let{fechas:e}=this.invoiceForm.value;return e}get formFlatObject(){let t=this.invoiceForm.value,{fechas:e}=t,i=T(t,["fechas"]);return I(I({},this.fechas),i)}get existInvoicesData(){return this.allInvoices.length>0}get hasEmptyValues(){return Object.values(this.formFlatObject).every(e=>e==="")}get textButton(){return this.showDateErrors?"Fechas no v\xE1lidas":"Buscar"}get dateErrors(){let{fechaInicio:e,fechaFin:i}=this.fechas,t=e&&i,s=i==="",u=e==="";return{isInvalidDates:!s&&u||s&&!u,invalidRange:t?X(i,e):!1,futureDate:t?q(i,new Date):!1}}get showDateErrors(){return this.dateErrors.invalidRange||this.dateErrors.futureDate||this.dateErrors.isInvalidDates}get totalPages(){return this.customDatatableService.getTotalPages({dataLength:this.filteredInvoices.length,pageSize:this.pageSize})}get recordsInfo(){if(this.filteredInvoices.length===0)return"No hay registros para mostrar";let{start:e,end:i,total:t}=this.customDatatableService.getPageData({currentPage:this.currentPage,pageSize:this.pageSize,dataLength:this.filteredInvoices.length});return`Mostrando ${e} - ${i} de ${t} registros`}get paginatedInvoices(){return this.customDatatableService.paginateData({data:this.filteredInvoices,currentPage:this.currentPage,pageSize:this.pageSize})}createInvoiceForm(){return this.fb.group({fechas:this.fb.group({fechaInicio:[""],fechaFin:[""]}),estatus:[""],numeroFactura:[""]})}showInitialMessage(){this.helperService.toastAlert({title:"Para consultar sus facturas, puede filtrar por rango de fechas, estatus o n\xFAmero de factura",icon:"info",timer:2500,timerProgressBar:!0})}ngOnInit(){this.allInvoices=this.facturasService.getInvoices(),this.filteredInvoices=[...this.allInvoices],this.showInitialMessage()}isSortable(e){return this.customDatatableService.isSortableColumn({exludeColumns:this.excludeColumnsForSort,column:e})}changePage(e){this.currentPage=e}sortDataEvent(e){if(!this.isSortable(e)||this.filteredInvoices.length===0)return;let i=e.includes("No. de factura")?"numero":this.helperService.normalizeText({text:e}),{data:t,sortColumn:s,sortDirection:u}=this.customDatatableService.sortData({column:i,data:this.allInvoices,sortColumn:this.sortColumn,sortDirection:this.sortDirection});this.filteredInvoices=t,this.sortColumn=s,this.sortDirection=u}isCancelledInvoice(e){return D.includes(e.estatus)}isSuccessInvoice(e){return w.includes(e.estatus)}cancelInvoiceValidation(e){return C(this,null,function*(){if(!e||!e.name.toLowerCase().includes(".xml"))return this.helperService.swal.showValidationMessage("Debes seleccionar un archivo XML")})}toCancel(e){let i="En proceso de cancelaci\xF3n";e.estatus=i}cancelInvoice(e){let i=this.helperService.getConfigModal({icon:"warning",title:"\xBFDeseas cancelar esta factura?",text:"Recuerda que no podras revertir esta accion y deberas de seleccionar un archivo XML",confirmButtonText:"Si, cancelar",showConfirmButton:!0,cancelButtonText:"Cancelar",showCancelButton:!0,width:"50%",input:"file",inputPlaceholder:"Selecciona un archivo XML",inputAttributes:{accept:"application/xml, text/xml, .xml","aria-label":"Selecciona un archivo XML"},preConfirm:t=>C(this,null,function*(){return yield this.cancelInvoiceValidation(t)})});this.helperService.toastAlert(i,t=>{t.isConfirmed&&this.toCancel(e)})}findInvoice(){let{isInvalidDates:e,invalidRange:i,futureDate:t}=this.dateErrors;if(e)return this.isLoading=!1,void this.helperService.toastAlert({title:"Debes seleccionar ambas fechas",icon:"error",timer:2e3});if(i)return this.isLoading=!1,void this.helperService.toastAlert({title:"El rango de fechas no es v\xE1lido",icon:"error",timer:2e3});if(t)return this.isLoading=!1,void this.helperService.toastAlert({title:"Debe seleccionar una fecha anterior al d\xEDa de hoy",icon:"error",timer:2e3});let{fechaInicio:s,fechaFin:u,estatus:S,numeroFactura:P}=this.helperService.cleanObject({obj:this.formFlatObject,cleanEmpty:!0});S&&(this.filteredInvoices=S.toLowerCase().includes("todas")?[...this.allInvoices]:this.filteredInvoices.filter(x=>x.estatus===S)),P&&(this.filteredInvoices=this.filteredInvoices.filter(x=>x.numero===P)),s&&u&&(this.filteredInvoices=this.dataTableService.filterDataByRangeDate({fechaFin:u,fechaInicio:s,data:this.filteredInvoices}))}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=N({type:r,selectors:[["app-facturas"]],decls:50,vars:25,consts:[[3,"titleSection"],[1,"mb-8"],[1,"bg-white","rounded-lg","shadow-xl","p-6","max-w-6xl","mx-auto","mb-2"],[1,"max-w-full","mx-auto","space-y-6",3,"formGroup"],["formGroupName","fechas",1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"space-y-1"],[1,"block","text-sm","font-medium","text-gray-700"],["type","date","formControlName","fechaInicio",1,"w-full","p-2","border","border-gray-300","rounded-lg","focus:ring-green-600","focus:border-green-600",3,"ngClass"],["type","date","formControlName","fechaFin",1,"w-full","p-2","border","border-gray-300","rounded-lg","focus:ring-green-600","focus:border-green-600",3,"ngClass"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["formControlName","estatus",1,"w-full","p-2","border","border-gray-300","rounded-lg","focus:ring-green-600","focus:border-green-600"],["value","","selected","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["type","text","formControlName","numeroFactura","placeholder","Buscar por n\xFAmero",1,"w-full","p-2","border","border-gray-300","rounded-lg","focus:ring-green-600","focus:border-green-600"],[1,"flex","justify-center"],[1,"bg-green-600","text-white","px-6","py-2","rounded-lg","hover:bg-green-700","transition-colors","disabled:bg-gray-500",3,"click","disabled","ngClass"],[1,"bg-white","rounded-lg","shadow-xl","p-6","max-w-6xl","mx-auto"],[1,"max-w-full","mx-auto","space-y-4"],[1,"overflow-x-auto","rounded-lg","border","border-gray-300","custom-scrollbar"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-green-600","text-white","uppercase","sticky","top-0","z-10"],["class","px-6 py-3 text-center text-sm font-medium tracking-wider",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"bg-white","divide-y","divide-gray-200"],[1,"text-center"],[1,"border-b","hover:bg-gray-50","text-center"],[1,"flex","justify-between","items-center","mt-4"],[1,"text-sm","text-gray-700"],[1,"inline-flex","-space-x-px","text-sm"],[1,"flex","items-center","justify-center","px-3","py-2","rounded-l-lg","bg-white","border","border-gray-300","text-gray-500","hover:bg-green-600","transition-colors","disabled:bg-gray-300",3,"click","disabled","ngClass"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 6 10",1,"w-3.5","h-3.5","me-2","rtl:rotate-180"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 1 1 5l4 4"],[1,"flex","items-center","justify-center","px-3","py-2","rounded-r-lg","bg-white","border","border-gray-300","text-gray-500","hover:bg-green-600","transition-colors","disabled:bg-gray-300",3,"click","disabled","ngClass"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 6 10",1,"w-3.5","h-3.5","ms-2","rtl:rotate-180"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 9 4-4-4-4"],[3,"value"],[1,"px-6","py-3","text-center","text-sm","font-medium","tracking-wider",3,"click","ngClass"],["class","ml-1",4,"ngIf"],[1,"ml-1"],["colspan","6",1,"px-3","py-2"],["class","border-b hover:bg-gray-50 text-center",4,"ngFor","ngForOf"],[1,"px-4","py-2"],[1,"px-4","py-2","text-sm",3,"ngClass"],["class","text-red-500 hover:text-red-700 text-sm font-medium border border-red-500 hover:border-red-700 hover:bg-red-100 rounded-lg px-2 py-1 transition-colors",3,"click",4,"ngIf"],[1,"text-red-500","hover:text-red-700","text-sm","font-medium","border","border-red-500","hover:border-red-700","hover:bg-red-100","rounded-lg","px-2","py-1","transition-colors",3,"click"]],template:function(i,t){i&1&&(n(0,"app-panel",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"label",6),c(7," Fecha de inicio "),a(),f(8,"input",7),a(),n(9,"div",5)(10,"label",6),c(11," Fecha de fin "),a(),f(12,"input",8),a()(),n(13,"div",9)(14,"div",5)(15,"label",6),c(16," Estatus "),a(),n(17,"select",10)(18,"option",11),c(19," Selecciona un estatus "),a(),g(20,he,2,2,"option",12),a()(),n(21,"div",5)(22,"label",6),c(23," N\xFAmero de factura "),a(),f(24,"input",13),a()(),n(25,"div",14)(26,"button",15),h("click",function(){return t.findInvoice()}),c(27),a()()()(),n(28,"div",16)(29,"div",17)(30,"div",18)(31,"table",19)(32,"thead",20)(33,"tr"),g(34,Se,3,5,"th",21),a()(),n(35,"tbody",22),g(36,xe,3,0,"tr",23)(37,_e,1,1,"tr",24),a()()(),n(38,"div",25)(39,"span",26),c(40),a(),n(41,"ul",27)(42,"li")(43,"button",28),h("click",function(){return t.changePage(t.currentPage-1)}),F(),n(44,"svg",29),f(45,"path",30),a()()(),A(),n(46,"li")(47,"button",31),h("click",function(){return t.changePage(t.currentPage+1)}),F(),n(48,"svg",32),f(49,"path",33),a()()()()()()()()()),i&2&&(l("titleSection",t.title),o(3),l("formGroup",t.invoiceForm),o(5),l("ngClass",v(15,ue,t.showDateErrors)),o(4),l("ngClass",v(17,ue,t.showDateErrors)),o(8),l("ngForOf",t.invoiceStatus),o(6),l("disabled",t.hasEmptyValues||t.showDateErrors)("ngClass",v(19,ge,t.hasEmptyValues||t.showDateErrors)),o(),d(" ",t.textButton," "),o(7),l("ngForOf",t.invoiceHeaders),o(2),O(t.filteredInvoices.length===0?36:37),o(4),d(" ",t.recordsInfo," "),o(3),l("disabled",t.currentPage===0)("ngClass",v(21,de,t.currentPage>0)),o(4),l("disabled",t.currentPage>=t.totalPages-1)("ngClass",v(23,de,t.currentPage<t.totalPages-1)))},dependencies:[G,j,L,z,R,ne,te,ie,J,ee,K,Q,W,Z,Y,ae,se],styles:[`.custom-scrollbar::-webkit-scrollbar{width:6px;height:6px}
`],encapsulation:2})};export{pe as FacturasComponent};
