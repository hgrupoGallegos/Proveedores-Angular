import{c as W}from"./chunk-SE5NYA22.js";import{a as U}from"./chunk-4BABL3KU.js";import{a as j}from"./chunk-CF4FKG4D.js";import{a as Z}from"./chunk-AJZXPOTM.js";import{a as L}from"./chunk-TVLHVE3P.js";import{a as K}from"./chunk-UGHFU27J.js";import{a as z,b as B,c as f,d as P,e as Q,j as Y,l as $,r as X,t as J}from"./chunk-LEWYKQGU.js";import{A as u,Ca as H,Da as G,Ea as M,Ga as q,J as l,M as k,Oa as b,Q as d,S as F,T as s,W as o,X as i,Y as c,Z as S,_ as h,b as T,ba as I,ea as N,fa as O,ga as V,ha as C,ia as r,ka as g,q as D,qa as R,t as A,ua as x,w as p}from"./chunk-MMKYUMEW.js";import{a as w,b as _,c as E}from"./chunk-EQDQRRRY.js";var v=class a{detailsService=p(W);helperService=p(b);satConceptsSource=new T([]);satConcepts$=this.satConceptsSource.asObservable();tableHeaders=["Clave Sat","Descripci\xF3n","Retenci\xF3n","Activo"];fechaAlta({date:e}){return j({date:new Date(e),format:"DD/MM/YYYY",tz:"America/Mexico_City",locale:"es-MX"})}getTableHeaders(){return[...this.tableHeaders]}formatSatConcepts(e){return e.map(n=>({claveSat:n.clave.trim(),descripcion:n.desc.trim(),retencion:n.retencion,activo:n.activo})).map(n=>this.helperService.replaceEmptyStrings(n))}formatSatConceptDetails(e){let t={clave:e.clave.toString(),estado:e.satestado.trim(),nombre:e.razonsocial.trim(),fechaAlta:this.fechaAlta({date:e.fechalta}),applyCatalog:e.sat};return this.helperService.replaceEmptyStrings(t)}updateSatConcepts(e){let t=this.formatSatConcepts(e);this.satConceptsSource.next(t)}satConceptsRequest(){return this.detailsService.detailRequest().pipe(D(e=>{let{token:t,conceptoSAT:n}=e;if(!t.toLowerCase().includes("invalid")){let{Table:m}=n;this.updateSatConcepts(m)}}))}static \u0275fac=function(t){return new(t||a)};static \u0275prov=A({token:a,factory:a.\u0275fac,providedIn:"root"})};var ne=["satConceptTable"],oe=a=>({"flex items-center":a});function re(a,e){a&1&&(u(),o(0,"svg",31),c(1,"path",32),i())}function le(a,e){if(a&1&&(o(0,"th",28)(1,"span",29),r(2),d(3,re,2,0,"svg",30),i()()),a&2){let t=e.$implicit,n=I();F("data-sortable",n.isSortable(t)),l(),s("ngClass",R(4,oe,n.isSortable(t))),l(),g(" ",t," "),l(),s("ngIf",n.isSortable(t))}}function ce(a,e){a&1&&(S(0),u(),o(1,"svg",36),c(2,"path",37)(3,"path",38),i(),h())}function se(a,e){a&1&&(u(),o(0,"svg",39),c(1,"rect",40),i())}function pe(a,e){a&1&&(S(0),u(),o(1,"svg",36),c(2,"path",37)(3,"path",38),i(),h())}function me(a,e){a&1&&(u(),o(0,"svg",39),c(1,"rect",40),i())}function de(a,e){if(a&1&&(o(0,"tr",33)(1,"td",34),r(2),i(),o(3,"td",34),r(4),i(),o(5,"td",34),d(6,ce,4,0,"ng-container",35)(7,se,2,0,"ng-template",null,1,x),i(),o(9,"td",34),d(10,pe,4,0,"ng-container",35)(11,me,2,0,"ng-template",null,2,x),i()()),a&2){let t=e.$implicit,n=C(8),m=C(12);l(2),g(" ",t.claveSat," "),l(2),g(" ",t.descripcion," "),l(2),s("ngIf",t.retencion)("ngIfElse",n),l(4),s("ngIf",t.activo)("ngIfElse",m)}}function ue(a,e){a&1&&c(0,"app-loader",41),a&2&&s("message","Obteniendo datos...")}var ee=class a{conceptoSatService=p(v);dataTableService=p(U);helperService=p(b);authService=p(L);fb=p(X);title="Conceptos SAT";satConceptDetailForm=this.createSatConceptForm();details={};tableHeaders=this.conceptoSatService.getTableHeaders();satConcepts=[];satConceptTable;dt;isActiveLoader=!1;ngOnInit(){this.loadConcepts(),this.conceptoSatService.satConcepts$.subscribe(e=>{this.satConcepts=e,this.satConcepts.length>0&&this.satConceptTable&&setTimeout(()=>{this.initializeDataTable(),this.isSortable()},150)})}ngAfterViewInit(){this.satConcepts.length>0&&this.initializeDataTable()}ngOnDestroy(){this.destroyDataTable()}destroyDataTable(){this.dt&&this.dt.destroy()}initializeDataTable(){this.satConceptTable&&(this.destroyDataTable(),this.dt=this.dataTableService.createDataTable({htmlElementTable:this.satConceptTable.nativeElement,searchable:!0,perPage:5,perPageSelect:!1,sortable:this.isSortable(),paging:!0}))}isSortable(e){return this.dataTableService.isSortable({header:e,toExclude:["Retenci\xF3n","Activo"],data:this.satConcepts})}createSatConceptForm(){return this.fb.group({clave:["",[f.required]],estado:["",[f.required]],nombre:["",[f.required]],fechaAlta:["",[f.required]],aplicaCatalogo:[{value:!1,disabled:!0},[f.required]]})}loadConcepts(){this.isActiveLoader=!0,this.conceptoSatService.satConceptsRequest().subscribe({next:e=>{let{token:t,details:n}=e;if(t.toLowerCase().includes("invalid"))return void this.authService.logoutSession().subscribe({complete:()=>this.helperService.toastAlert({title:"Sesion Expirada",icon:"warning",timer:2e3,position:"top"})});let{Table:[m]}=n,y=this.conceptoSatService.formatSatConceptDetails(m),{applyCatalog:te}=y,ie=E(y,["applyCatalog"]);this.details=ie,this.satConceptDetailForm.patchValue(_(w({},this.details),{aplicaCatalogo:te}))},complete:()=>this.isActiveLoader=!1})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=k({type:a,selectors:[["app-concepto-sat"]],viewQuery:function(t,n){if(t&1&&N(ne,5),t&2){let m;O(m=V())&&(n.satConceptTable=m.first)}},decls:50,vars:5,consts:[["satConceptTable",""],["uncheckRetencion",""],["uncheckActivo",""],[3,"titleSection"],[1,"mb-8"],[1,"bg-white","rounded-lg","shadow-xl","p-5","max-w-6xl","mx-auto","mb-2",3,"formGroup"],[1,"max-w-full","mx-auto"],[1,"space-y-4","mb-6","md:mb-8","form-group"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"space-y-2"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"flex"],[1,"inline-flex","items-center","px-3","text-sm","text-white","bg-green-600","border-gray-300","rounded-s-md","shadow-sm"],["type","text","formControlName","clave","readonly","",1,"form-input","rounded-none","rounded-e-lg","bg-gray-50","border","border-gray-300","text-gray-900","focus:ring-green-600","focus:border-green-600","block","flex-1","min-w-0","w-full","text-sm","p-2"],["type","text","formControlName","fechaAlta","readonly","",1,"form-input","rounded-none","rounded-e-lg","bg-gray-50","border","border-gray-300","text-gray-900","focus:ring-green-600","focus:border-green-600","block","flex-1","min-w-0","w-full","text-sm","p-2"],["type","text","formControlName","estado","readonly","",1,"form-input","rounded-none","rounded-e-lg","bg-gray-50","border","border-gray-300","text-gray-900","focus:ring-green-600","focus:border-green-600","block","flex-1","min-w-0","w-full","text-sm","p-2"],["type","text","formControlName","nombre","readonly","",1,"form-input","rounded-none","rounded-e-lg","bg-gray-50","border","border-gray-300","text-gray-900","focus:ring-green-600","focus:border-green-600","block","flex-1","min-w-0","w-full","text-sm","p-2"],[1,"flex","flex-col","md:flex-row","items-start","md:items-center","gap-4","mb-2"],[1,"bg-yellow-100","text-yellow-800","px-4","py-3","rounded-lg","flex-1"],[1,"flex","items-center","space-x-2"],["type","checkbox","formControlName","aplicaCatalogo",1,"w-4","h-4","text-green-600","bg-gray-100","border-gray-300","rounded","focus:ring-green-500"],[1,"text-gray-700"],[1,"bg-white","rounded-lg","shadow-xl","p-6","max-w-6xl","mx-auto"],[1,"min-w-full","divide-y","divide-gray-300","rounded-lg"],["class","bg-green-600 text-white px-4 py-2 text-sm font-medium tracking-wider",4,"ngFor","ngForOf"],[1,"bg-white","divide-y","divide-gray-300"],["class","border-b hover:bg-gray-50 text-center",4,"ngFor","ngForOf"],[3,"message",4,"ngIf"],[1,"bg-green-600","text-white","px-4","py-2","text-sm","font-medium","tracking-wider"],[1,"uppercase",3,"ngClass"],["class","w-4 h-4 ms-1","aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",4,"ngIf"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",1,"w-4","h-4","ms-1"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m8 15 4 4 4-4m0-6-4-4-4 4"],[1,"border-b","hover:bg-gray-50","text-center"],[1,"px-4","py-2"],[4,"ngIf","ngIfElse"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-5","h-5","text-green-600","mx-auto"],["d","M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2z"],["d","M9 12l2 2 4-4","stroke-linecap","round","stroke-linejoin","round"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-5","h-5","text-gray-400","mx-auto"],["x","3","y","3","width","18","height","18","rx","2","ry","2"],[3,"message"]],template:function(t,n){t&1&&(o(0,"app-panel",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"div",8)(6,"div",9)(7,"label",10),r(8," Clave "),i(),o(9,"div",11)(10,"span",12),r(11," No. "),i(),c(12,"input",13),i()(),o(13,"div",9)(14,"label",10),r(15," Alta "),i(),o(16,"div",11)(17,"span",12),r(18," Fecha "),i(),c(19,"input",14),i()(),o(20,"div",9)(21,"label",10),r(22," Estado "),i(),o(23,"div",11)(24,"span",12),r(25," Tipo "),i(),c(26,"input",15),i()()(),o(27,"div",9)(28,"label",10),r(29," Raz\xF3n social "),i(),o(30,"div",11)(31,"span",12),r(32," Nombre "),i(),c(33,"input",16),i()()(),o(34,"div",17)(35,"div",18),r(36," * Al estar activa la casilla se validar\xE1 cada concepto "),i(),o(37,"label",19),c(38,"input",20),o(39,"span",21),r(40,"Aplica cat\xE1logo SAT"),i()()()()(),o(41,"div",22)(42,"table",23,0)(44,"thead")(45,"tr"),d(46,le,4,6,"th",24),i()(),o(47,"tbody",25),d(48,de,13,6,"tr",26),i()()()(),d(49,ue,1,1,"app-loader",27),i()),t&2&&(s("titleSection",n.title),l(2),s("formGroup",n.satConceptDetailForm),l(44),s("ngForOf",n.tableHeaders),l(2),s("ngForOf",n.satConcepts),l(),s("ngIf",n.isActiveLoader))},dependencies:[q,H,G,M,J,B,z,P,Q,Y,$,Z,K],encapsulation:2})};export{ee as ConceptoSatComponent};
